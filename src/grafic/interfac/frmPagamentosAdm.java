/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package grafic.interfac;

import DAO.CondicionalDAO;
import DAO.ContasReceberDAO;
import DAO.MovimentoContaDAO;
import DAO.lancDocumentDAO;
import DAO.lancamentoTiroDAO;
import DAO.listaDAO;
import DAO.nfeDAO;
import DAO.orcamentoDAO;
import DAO.orderServicoDAO;
import model.CadContasRecPagar;
import model.clsDadosPagamentoAdm;
import model.clsLancamentoTiro;
import model.clsOrcamento;
import model.clsPagamentos;
import classes.clsaux;
import conexoes.conexao;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import model.CadDocMovConta;
import model.clsConfig;
import model.clsNfTransporte;
import model.clsNfe;

/**
 *
 * @author RKochhann
 */
public class frmPagamentosAdm extends javax.swing.JDialog {

    /**
     * Creates new form FinalizaOs
     */
    
   
    public frmPagamentosAdm(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        this.inicia();
        this.carregaDadosVenda();
    }
     public static clsDadosPagamentoAdm pagamento;
     public static clsOrcamento orcamento;
     
     int parcela=1;
     
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        lbDesc = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jLabel1 = new javax.swing.JLabel();
        lbServicos = new javax.swing.JLabel();
        jPanel3 = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        cbFinalizadora = new javax.swing.JComboBox();
        jLabel8 = new javax.swing.JLabel();
        txtValor = new javax.swing.JTextField();
        btnIncluirValor = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        tbFin = new javax.swing.JTable();
        jlDelServ = new javax.swing.JLabel();
        cbCondi = new javax.swing.JComboBox();
        jLabel9 = new javax.swing.JLabel();
        lbtipotroco = new javax.swing.JLabel();
        lbTroco = new javax.swing.JLabel();
        lbProdutos = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel10 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        lbTotal = new javax.swing.JLabel();
        btnFinalizar = new javax.swing.JButton();
        lbIdRegistro = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        txtDesc = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Pagamento Lancamento");

        jPanel1.setBackground(new java.awt.Color(219, 227, 227));

        jPanel2.setBackground(new java.awt.Color(255, 255, 255));
        jPanel2.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED, null, new java.awt.Color(0, 102, 102), new java.awt.Color(0, 102, 102), null));

        lbDesc.setBackground(new java.awt.Color(255, 255, 255));
        lbDesc.setFont(new java.awt.Font("Arial Narrow", 0, 18)); // NOI18N
        lbDesc.setForeground(new java.awt.Color(204, 0, 0));
        lbDesc.setText("Finaliza");

        jLabel1.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel1.setText("Serviços");

        lbServicos.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        lbServicos.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbServicos.setText("0,00");
        lbServicos.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        lbServicos.setEnabled(false);

        jPanel3.setBackground(new java.awt.Color(219, 227, 227));
        jPanel3.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));

        jLabel7.setBackground(new java.awt.Color(255, 255, 255));
        jLabel7.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel7.setText("Finalizadora");

        cbFinalizadora.setFont(new java.awt.Font("Tahoma", 0, 16)); // NOI18N
        cbFinalizadora.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbFinalizadoraActionPerformed(evt);
            }
        });

        jLabel8.setBackground(new java.awt.Color(255, 255, 255));
        jLabel8.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel8.setText("Valor");

        txtValor.setFont(new java.awt.Font("Arial", 0, 16)); // NOI18N
        txtValor.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtValor.setText("0,00");
        txtValor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtValorActionPerformed(evt);
            }
        });

        btnIncluirValor.setFont(new java.awt.Font("Tahoma", 0, 16)); // NOI18N
        btnIncluirValor.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/IncluirFinan.png"))); // NOI18N
        btnIncluirValor.setText("Incluir");
        btnIncluirValor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnIncluirValorActionPerformed(evt);
            }
        });

        tbFin.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        tbFin.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Finalizadora", "Valor", "Data", "Parcela", "Troco"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, true, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tbFin.setAutoResizeMode(javax.swing.JTable.AUTO_RESIZE_OFF);
        tbFin.setRowHeight(20);
        tbFin.getTableHeader().setReorderingAllowed(false);
        jScrollPane1.setViewportView(tbFin);
        if (tbFin.getColumnModel().getColumnCount() > 0) {
            tbFin.getColumnModel().getColumn(0).setResizable(false);
            tbFin.getColumnModel().getColumn(0).setPreferredWidth(100);
            tbFin.getColumnModel().getColumn(1).setResizable(false);
            tbFin.getColumnModel().getColumn(1).setPreferredWidth(80);
            tbFin.getColumnModel().getColumn(2).setResizable(false);
            tbFin.getColumnModel().getColumn(2).setPreferredWidth(70);
            tbFin.getColumnModel().getColumn(3).setResizable(false);
            tbFin.getColumnModel().getColumn(3).setPreferredWidth(50);
        }

        jlDelServ.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/DelFinan.png"))); // NOI18N
        jlDelServ.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jlDelServMouseClicked(evt);
            }
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                jlDelServMouseEntered(evt);
            }
        });

        cbCondi.setFont(new java.awt.Font("Tahoma", 0, 16)); // NOI18N

        jLabel9.setBackground(new java.awt.Color(255, 255, 255));
        jLabel9.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel9.setText("Condição");

        lbtipotroco.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        lbtipotroco.setText("Falta");

        lbTroco.setFont(new java.awt.Font("Arial", 0, 16)); // NOI18N
        lbTroco.setForeground(new java.awt.Color(204, 0, 0));
        lbTroco.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbTroco.setText("0,00");

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jLabel8)
                    .addComponent(jLabel7)
                    .addComponent(cbFinalizadora, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jLabel9)
                    .addComponent(txtValor)
                    .addComponent(cbCondi, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btnIncluirValor, javax.swing.GroupLayout.DEFAULT_SIZE, 150, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(lbtipotroco, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lbTroco, javax.swing.GroupLayout.PREFERRED_SIZE, 90, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jlDelServ))
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 389, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 179, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jlDelServ))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(jLabel7)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbFinalizadora, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel9)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbCondi, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jLabel8)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtValor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnIncluirValor)
                            .addComponent(lbtipotroco, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lbTroco, javax.swing.GroupLayout.PREFERRED_SIZE, 34, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(36, Short.MAX_VALUE))
        );

        lbProdutos.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        lbProdutos.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbProdutos.setText("0,00");
        lbProdutos.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        lbProdutos.setEnabled(false);

        jLabel4.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel4.setText("Produtos");

        jLabel10.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        jLabel10.setText("Descontos");

        jLabel11.setFont(new java.awt.Font("Arial", 0, 16)); // NOI18N
        jLabel11.setText("Total");

        lbTotal.setFont(new java.awt.Font("Arial", 1, 30)); // NOI18N
        lbTotal.setForeground(new java.awt.Color(153, 0, 0));
        lbTotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbTotal.setText("0,00");
        lbTotal.setBorder(javax.swing.BorderFactory.createEtchedBorder(null, new java.awt.Color(153, 0, 0)));

        btnFinalizar.setFont(new java.awt.Font("Tahoma", 1, 16)); // NOI18N
        btnFinalizar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/Confirma.png"))); // NOI18N
        btnFinalizar.setText("FINALIZAR");
        btnFinalizar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnFinalizarActionPerformed(evt);
            }
        });

        lbIdRegistro.setFont(new java.awt.Font("Arial", 1, 36)); // NOI18N
        lbIdRegistro.setForeground(new java.awt.Color(204, 0, 0));
        lbIdRegistro.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbIdRegistro.setText("0000");

        jLabel14.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        jLabel14.setText("Registro");

        txtDesc.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        txtDesc.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtDesc.setText("0,00");
        txtDesc.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtDescFocusLost(evt);
            }
        });
        txtDesc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtDescActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lbDesc, javax.swing.GroupLayout.PREFERRED_SIZE, 357, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jLabel14)
                        .addGap(39, 39, 39)
                        .addComponent(lbIdRegistro, javax.swing.GroupLayout.PREFERRED_SIZE, 136, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btnFinalizar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                        .addComponent(jSeparator1, javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel2Layout.createSequentialGroup()
                            .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel10)
                                .addComponent(jLabel4)
                                .addComponent(jLabel1)
                                .addComponent(jLabel11)
                                .addComponent(lbTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 125, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(txtDesc, javax.swing.GroupLayout.PREFERRED_SIZE, 125, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(lbProdutos, javax.swing.GroupLayout.PREFERRED_SIZE, 125, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(lbServicos, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))))
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lbIdRegistro, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lbDesc, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel14)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lbServicos, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel4)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(lbProdutos, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel10)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtDesc, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(44, 44, 44)
                        .addComponent(jLabel11)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(lbTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(btnFinalizar, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(33, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 54, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnIncluirValorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnIncluirValorActionPerformed
        if(txtValor.getText().equals("")||txtValor.getText().equals("0,00")){
            JOptionPane.showMessageDialog(null, "Valor incorreto!!!");
        }else{
            this.dadosFinalizadora();
        }
    }//GEN-LAST:event_btnIncluirValorActionPerformed

    private void jlDelServMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jlDelServMouseClicked
        this.excluiFinalizadora();
        this.calculaTroco();
    }//GEN-LAST:event_jlDelServMouseClicked

    private void btnFinalizarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnFinalizarActionPerformed
        this.validaDadosFinalizar();
    }//GEN-LAST:event_btnFinalizarActionPerformed

    private void txtDescFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtDescFocusLost
        this.calculaDesc();
    }//GEN-LAST:event_txtDescFocusLost

    private void cbFinalizadoraActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbFinalizadoraActionPerformed
       String fin= cbFinalizadora.getSelectedItem().toString();
       int fi = Integer.parseInt(clsaux.retornaId(fin));
       cbCondi.removeAllItems();
        if (fi>3){
            DefaultComboBoxModel cb = new DefaultComboBoxModel ( listaDAO.listaCondicaoVenda().toArray());
            cbCondi.setModel(cb);
        }
    }//GEN-LAST:event_cbFinalizadoraActionPerformed

    private void jlDelServMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jlDelServMouseEntered
        // TODO add your handling code here:
    }//GEN-LAST:event_jlDelServMouseEntered

    private void txtValorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtValorActionPerformed
        btnIncluirValor.requestFocus();
    }//GEN-LAST:event_txtValorActionPerformed

    private void txtDescActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtDescActionPerformed
      txtValor.requestFocus();
      
    }//GEN-LAST:event_txtDescActionPerformed

    public void inicia(){
         DefaultComboBoxModel cb = new DefaultComboBoxModel(listaDAO.listapagamento().toArray());
         cbFinalizadora.setModel(cb);
         lbtipotroco.setText("Falta");
         lbTroco.setText(lbTotal.getText());
    }
    public void carregaDadosVenda(){
        lbServicos.setText(clsaux.formato(pagamento.getVlservico()));
        lbProdutos.setText(clsaux.formato(pagamento.getVlprod()));
        lbTotal.setText(clsaux.formato(pagamento.getVltotal()));
        lbTroco.setText(lbTotal.getText());
        txtValor.setText(lbTotal.getText());
        if(pagamento.getTipo().equals("Condicional")){
            lbIdRegistro.setText(pagamento.getIdcondicional()); 
            lbDesc.setText("Finaliza Condicional");
        }
        if(pagamento.getTipo().equals("Ordem De Servico")){
            lbIdRegistro.setText(pagamento.getIdos()); 
            lbDesc.setText("Finaliza Ordem De Servico");
        }
        if(pagamento.getTipo().equals("Pedido")){
            lbIdRegistro.setText(pagamento.getIdpedido());
            lbDesc.setText("Finaliza Pedido");
            this.receberPagamentoAnterior();
        } 
        
    }
    public void dadosFinalizadora(){
        DefaultTableModel tb = (DefaultTableModel) tbFin.getModel();
        Double valor=Double.parseDouble(lbTotal.getText().replaceAll(",", "."));
        Double pago=0.00;
        Double informado=Double.parseDouble(txtValor.getText().replaceAll(",", "."));
        int idfinalizadora=Integer.parseInt(clsaux.retornaId(cbFinalizadora.getSelectedItem().toString()));
        int tab=tbFin.getRowCount();
        for (int i=0; i<tab; i++){
            pago =pago+Double.parseDouble(tbFin.getValueAt(i, 1).toString().replaceAll(",", "."));
        }
        if(pago<valor){
            if (idfinalizadora>3&&idfinalizadora<7){
                String [] prazos=listaDAO.listaPrazoCondicao(clsaux.retornaId(cbCondi.getSelectedItem().toString()));
                int parcelas=prazos.length;
                Double vlparcela=informado/parcelas;
                for (int i=0; i<parcelas; i++){
                   int dias=Integer.parseInt(prazos[i]);
                   tb.addRow(new Object[]{
                       cbFinalizadora.getSelectedItem(),
                       clsaux.formato(vlparcela),
                       clsaux.calcularDataVencimento(dias),
                       geraParcela(),
                       "0,00"
                   });
                   
                }
            } else{
                Double troco=informado-valor;
                if(troco<0)troco=0.00;
                tb.addRow(new Object[]{
                    cbFinalizadora.getSelectedItem(),
                    clsaux.formato(informado),
                    clsaux.preencheData(),
                    geraParcela(),
                    clsaux.formato(troco)
                });
                
            }
        }
        else {
            JOptionPane.showMessageDialog(null, "Valor inserido maior que o total!!!");
        }
        txtValor.setText("0,00");
        this.calculaTroco();
        btnFinalizar.requestFocus();
    }
    public void excluiFinalizadora(){
       DefaultTableModel tb = (DefaultTableModel) tbFin.getModel();
       orcamentoDAO.removeFinalizadora(orcamento.getId(), tbFin.getValueAt(tbFin.getSelectedRow(), 3).toString());
       tb.removeRow(tbFin.getSelectedRow());
    }
    public void finalizaOs(){
        orderServicoDAO os= new orderServicoDAO();
        String desc= clsaux.capturaValor(txtDesc.getText());
        int reg= tbFin.getRowCount();
        String vlfina,idfina=null;
        lancDocumentDAO documentDAO = new lancDocumentDAO();
        String mvto=documentDAO.gerarVendaApartirLancamento("OS", pagamento.getIdos(), "99", "6", pagamento.getParceiro(),"4",desc);
        for (int i=0; i<reg; i++){
            idfina=clsaux.retornaId(tbFin.getValueAt(i, 0).toString());
            vlfina= clsaux.formatoNfe(clsaux.capturaValores(tbFin.getValueAt(i, 1).toString())-clsaux.capturaValores(tbFin.getValueAt(i, 4).toString()));
            String datavenc=tbFin.getValueAt(i, 2).toString();
            os.inserirFinalizadora(pagamento.getIdos(), idfina, vlfina,tbFin.getValueAt(i, 3).toString());
            if (Integer.parseInt(idfina)<4||Integer.parseInt(idfina)>6){
                this.gravaMovtoPagVista(vlfina, idfina,mvto,pagamento.getIdos());
            }else if (Integer.parseInt(idfina)>3||Integer.parseInt(idfina)<7){
                this.gravaMovtoPagPrazo(vlfina, idfina,datavenc,mvto);
            }
        }
        String total=lbTotal.getText().replaceAll(",", ".");
        os.alteraEstadoFinalizado(pagamento.getIdos(), desc,total);
        //os.inserirFinalizadoraVendaFinalizada(pagamento.getIdos(), mvto);
        JOptionPane.showMessageDialog(null, "Os Finalizado com sucesso");
        int y=JOptionPane.showConfirmDialog(null, "Deseja Imprimir os O.S", "Impressao ordem",JOptionPane.YES_NO_OPTION,HEIGHT);
        if (y==JOptionPane.YES_OPTION){
            frmSelecionaImpressaoOs.idos=pagamento.getIdos();
            frmSelecionaImpressaoOs dialog = new frmSelecionaImpressaoOs(new javax.swing.JFrame(), true); 
            dialog.setLocationRelativeTo(null);
            dialog.setVisible(true);
           };
         y=JOptionPane.showConfirmDialog(null, "Deseja Gerar Uma NFe Referente a Venda?", "Gerar Nfe",JOptionPane.YES_NO_OPTION);
         if (y==JOptionPane.YES_OPTION){
           this.gerarNfe(mvto);
           };
        this.dispose();
        CRUDservicos.btnLocalizarOs.requestFocus();
    }
     public void finalizaPedido(){
        orcamentoDAO os= new orcamentoDAO();
        String desc= clsaux.capturaValor(txtDesc.getText());
        int reg= tbFin.getRowCount();
        String vlfina,idfina=null;
        lancDocumentDAO documentDAO = new lancDocumentDAO();
        String mvtogerado=documentDAO.gerarVendaApartirLancamento(pagamento.getTipo(), pagamento.getIdpedido(), "99", "2", pagamento.getParceiro(),"3",desc);
        for (int i=0; i<reg; i++){
            idfina=clsaux.retornaId(tbFin.getValueAt(i, 0).toString());
            vlfina= clsaux.formatoNfe(clsaux.capturaValores(tbFin.getValueAt(i, 1).toString())-clsaux.capturaValores(tbFin.getValueAt(i, 4).toString()));
            String datavenc=tbFin.getValueAt(i, 2).toString();
            os.inserirFinalizadora(pagamento.getIdpedido(), idfina, vlfina,tbFin.getValueAt(i, 3).toString(),datavenc);
            if (Integer.parseInt(idfina)<4||Integer.parseInt(idfina)>6){
                this.gravaMovtoPagVista(vlfina, idfina,mvtogerado,pagamento.getIdpedido());
            }else if (Integer.parseInt(idfina)>3||Integer.parseInt(idfina)<7){
                this.gravaMovtoPagPrazo(vlfina, idfina,datavenc,mvtogerado);
            }
        }
        
        
        String total=lbTotal.getText().replaceAll(",", ".");
        orcamento.setEstado("2");
        os.atualizaRegistro(orcamento);
        os.inserirFinalizadoraVendaFinalizada(orcamento.getId(),mvtogerado);
        //JOptionPane.showMessageDialog(null, "Pedido Finalizado com sucesso");
        int y=JOptionPane.showConfirmDialog(null, "Deseja Gerar Uma NFe Referente a Venda?", "Gerar Nfe",JOptionPane.YES_NO_OPTION);
        if (y==JOptionPane.YES_OPTION){
           this.gerarNfe(mvtogerado);
           };
         y=JOptionPane.showConfirmDialog(null, "Deseja Imprimir o Pedido?", "Impressão Pedido",JOptionPane.YES_NO_OPTION);
        if (y==JOptionPane.YES_OPTION){
           CRUDOrcamentos.imprimirOrcamento(orcamento.getId());
           };
        this.dispose();
        CRUDOrcamentos.btnLocalizar.requestFocus();
    }
    
     public void finalizaCondicional(){
          List<String> id= new ArrayList();
          id.add(orcamento.getId());
          String desc= clsaux.capturaValor(txtDesc.getText());
          CondicionalDAO.atualizaBaixaConferencia(id, "12");
          lancDocumentDAO documentDAO = new lancDocumentDAO();
          lancamentoTiroDAO tdao= new lancamentoTiroDAO();
          String mvtogerado=documentDAO.gerarVendaApartirLancamento(pagamento.getTipo(), pagamento.getIdcondicional(), "99", "2", pagamento.getParceiro(),"2",desc);
          int reg= tbFin.getRowCount();
          String vlfina,idfina=null;
          for (int i=0; i<reg; i++){
            idfina=clsaux.retornaId(tbFin.getValueAt(i, 0).toString());
            vlfina= clsaux.formatoNfe(clsaux.capturaValores(tbFin.getValueAt(i, 1).toString())-clsaux.capturaValores(tbFin.getValueAt(i, 4).toString()));  //tbFin.getValueAt(i, 1).toString().replaceAll(",", ".");
            String datavenc=tbFin.getValueAt(i, 2).toString();
            tdao.insereFinalidoraVenda(idfina, vlfina, mvtogerado, pagamento.getParceiro(), 0.00, clsaux.retornaData(datavenc));
            if (Integer.parseInt(idfina)<4||Integer.parseInt(idfina)>6){
                this.gravaMovtoPagVista(vlfina, idfina,mvtogerado,pagamento.getIdcondicional());
            }else if (Integer.parseInt(idfina)>3||Integer.parseInt(idfina)<7){
                this.gravaMovtoPagPrazo(vlfina, idfina,datavenc,mvtogerado);
            }
         }
          this.dispose();
        }
     
     
     
     
     
     
     
    public void calculaDesc(){
        String vl=clsaux.formato(pagamento.getSubtotal()-Double.parseDouble(txtDesc.getText().replaceAll(",", ".")));
        lbTotal.setText(vl);
        pagamento.setVltotal(clsaux.capturaValores(vl));
        lbTroco.setText(lbTotal.getText());
        txtValor.setText(lbTotal.getText());
    }
    
    public void gerarNfe(String mvto){
       clsNfe nf = new clsNfe();
       nf.setId_movimento(mvto);
       nf.setCstat("0");
       nf.setConsfinal("1");
       nf.setFinalidade("1");
       nf.setInddest("1");
       nf.setIndie("1");
       nf.setPrescomp("1");
       nf.setConsfinal("N");
       nfeDAO.gerarNfePartirVenda(nf);
       clsNfTransporte tr= new clsNfTransporte();
       tr.setIdmovimento(mvto);
       tr.setModfrete("9");
       nfeDAO.inserirAtualizaTransporteNf(tr);
       
       CRUDNfe.carregaAutomatico="S";
       CRUDNfe dialog = new CRUDNfe(new javax.swing.JFrame(), true);
       dialog.setLocationRelativeTo(null);
       dialog.setVisible(true);
    
    }
    public void gravaMovtoPagVista(String valor,String idfin,String mvt,String origem){
        MovimentoContaDAO mc= new MovimentoContaDAO();
        CadDocMovConta cadmc= new CadDocMovConta();
        cadmc.setIdconta("1");
        cadmc.setIdparceiro(pagamento.getParceiro());
        cadmc.setN_doc("");
        cadmc.setData_lancamento(clsaux.retornaData(clsaux.preencheData()));
        cadmc.setTipo_mov(clsConfig.financeiro.getTpPedido());
        cadmc.setSubtipo_mov(clsConfig.financeiro.getSbPediso());
        cadmc.setEntrada(valor);
        cadmc.setSaida("0.00");
        cadmc.setData_venc("");
        cadmc.setIdfinalizadora(idfin);
        cadmc.setObservacao("Rec. Ref. "+pagamento.getTipo()+": "+origem);
        cadmc.setDesc_mov("movimentacao automatica referente a "+pagamento.getTipo()+": "+origem);
        cadmc.setIdmov(mvt);
        mc.inserir(cadmc);
        
        
        //mc.inserirPorRecebimentoTitulo(1, "1", "14", valor, idfin, "E", pagamento.getParceiro(),"Rec. Ref. "+pagamento.getTipo());
        
       
    }
    public void gravaMovtoPagPrazo(String valor,String idfin, String datavencimento,String mvto){
        CadContasRecPagar cd = new CadContasRecPagar();
        ContasReceberDAO cr = new ContasReceberDAO();
        cd.setIdmovto(mvto);
        cd.setParceiro(pagamento.getParceiro());
        cd.setValor(valor);
        cd.setNumero(pagamento.getIdos());
        cd.setEmisao(clsaux.retornaData(clsaux.preencheData()));
        cd.setVencimento(clsaux.retornaData(datavencimento));
        cd.setEstadotitulo("4");
        cd.setTipo_titulo(idfin);
        cd.setConta("1");
        cd.setHistorico("10");
        cd.setTipo("2");
        cd.setIdcontrato("0");
        cd.setBanco("1");
        cd.setVendedor("0");
        cd.setParcela("1");
        cd.setJuros("0.00");
        cd.setDesconto("0.00");
        cd.setSaldo(valor);
        cd.setQntParcelas("1");
        cd.setTipofinanceiro(clsConfig.financeiro.getTpPedido());
        cd.setSubtipofinanceiro(clsConfig.financeiro.getSbPediso());
        cr.inserir(cd);
    }
    public void validaDadosFinalizar(){
        int linha=tbFin.getRowCount();
        Double total=0.00,valorinserido=0.00;
        for (int i=0; i<linha; i++){
            valorinserido=valorinserido+Double.parseDouble(tbFin.getValueAt(i, 1).toString().replaceAll(",", "."));
        }
        valorinserido=clsaux.capturaValores(clsaux.formato(valorinserido));
        total=Double.parseDouble(lbTotal.getText().replaceAll(",", "."));
        if(valorinserido<total){
            JOptionPane.showMessageDialog(null, "Total da finalizadora menor que o total!!!");
        }else{
          if(pagamento.getTipo().equals("Condicional"))this.finalizaCondicional();
          if(pagamento.getTipo().equals("Ordem De Servico"))this.finalizaOs();
          if(pagamento.getTipo().equals("Pedido"))this.finalizaPedido();
            
        }
    
    
    }
    public void calculaTroco(){
        int linha=tbFin.getRowCount();
        Double total=0.00,valorinserido=0.00,restante=0.00;
        for (int i=0; i<linha; i++){
            valorinserido=valorinserido+Double.parseDouble(tbFin.getValueAt(i, 1).toString().replaceAll(",", "."));
        }
        total=Double.parseDouble(lbTotal.getText().replaceAll(",", "."));
        restante=total-valorinserido;
        if (restante<0){
            lbtipotroco.setText("Troco");
            lbTroco.setText(clsaux.formato(restante*-1));
        }else {
            lbtipotroco.setText("Falta");
            lbTroco.setText(clsaux.formato(restante));
        }
    
    }
    public void receberPagamentoAnterior(){
        orcamentoDAO dao= new orcamentoDAO();
        List<clsPagamentos> lista= dao.retornaListaPagamentoPedidoOrcamento(orcamento.getId());
        DefaultTableModel tb= (DefaultTableModel) tbFin.getModel();
        for(clsPagamentos novo:lista){
            tb.addRow(new Object []{
                novo.getIdfinalizadora(),
                novo.getValor(),
                clsaux.convertDataExib(novo.getDataemissao()),
                novo.getParcela(),
                "0,00"
            });
        }
    }
    
    public int geraParcela(){
        int registros=0;
        int parce=0;
        int contador=0;
        registros=tbFin.getRowCount();
        
        for(int i=0; i<registros; i++){
            contador= Integer.parseInt(tbFin.getValueAt(i, 3).toString());
            if(contador>parce){
                parce=contador;
                
            }
       }
        parce++;
        return parce;
    }
    
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(frmPagamentosAdm.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(frmPagamentosAdm.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(frmPagamentosAdm.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(frmPagamentosAdm.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                frmPagamentosAdm dialog = new frmPagamentosAdm(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    public static javax.swing.JButton btnFinalizar;
    private javax.swing.JButton btnIncluirValor;
    private javax.swing.JComboBox cbCondi;
    private javax.swing.JComboBox cbFinalizadora;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JLabel jlDelServ;
    private javax.swing.JLabel lbDesc;
    private javax.swing.JLabel lbIdRegistro;
    private javax.swing.JLabel lbProdutos;
    private javax.swing.JLabel lbServicos;
    private javax.swing.JLabel lbTotal;
    private javax.swing.JLabel lbTroco;
    private javax.swing.JLabel lbtipotroco;
    private javax.swing.JTable tbFin;
    private javax.swing.JTextField txtDesc;
    private javax.swing.JTextField txtValor;
    // End of variables declaration//GEN-END:variables
}
