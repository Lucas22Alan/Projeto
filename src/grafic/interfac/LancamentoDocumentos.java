/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package grafic.interfac;

import grafic.interfac.pesquisa.formProcuraCliente;
import DAO.ContasReceberDAO;
import DAO.MovimentoContaDAO;
import DAO.custosDAO;
import DAO.lancDocumentDAO;
import DAO.lancamentoTiroDAO;
import DAO.listaDAO;
import DAO.produtoDAO;
import br.com.swconsultoria.nfe.schema_4.enviNFe.TEnviNFe;
import br.com.swconsultoria.nfe.schema_4.enviNFe.TIpi;
import br.com.swconsultoria.nfe.schema_4.enviNFe.TNFe;
import model.CadContasRecPagar;
import model.CadDocMovConta;
import model.clsConfig;
import model.clsLancDocCabecalho;
import model.clsLancDocument;
import classes.clsLocalizaProduto;
import classes.clsaux;
import com.sun.glass.events.KeyEvent;
import conexoes.conexao;
import java.awt.Color;
import java.awt.Component;
import java.awt.event.ActionEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.AbstractAction;
import javax.swing.DefaultComboBoxModel;
import javax.swing.InputMap;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTable;
import javax.swing.KeyStroke;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import util.validaDataTabela;
import util.validaDigitosBarras;


/**
 *
 * @author Rodrigo
 */
public class LancamentoDocumentos extends javax.swing.JDialog {

    /**
     * Creates new form LancamentoDocumentos
     */
    
    TNFe.InfNFe inf;
    public static List <clsLancDocument> itens= new ArrayList();
    public LancamentoDocumentos(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        this.inicializa();
    }
    
    public LancamentoDocumentos(java.awt.Frame parent, boolean modal,TEnviNFe envNfe,String parceiro) {
        super(parent, modal);
        initComponents();
        this.inicializa();
        inf=envNfe.getNFe().get(0).getInfNFe();
        this.inciaLeituraNfe(parceiro);
        
        
    }
    
    
    
    public static String idmovimento=null,estadoform="O";
    public static String tipomovto="0";
    public static int numeitem=1;
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        txtMovto = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtDocumento = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        ftDatemissao = new javax.swing.JFormattedTextField();
        ftDatlancamento = new javax.swing.JFormattedTextField();
        jLabel5 = new javax.swing.JLabel();
        txtIdParceiro = new javax.swing.JTextField();
        txtRazaoSocial = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        txtSerie = new javax.swing.JTextField();
        jLabel15 = new javax.swing.JLabel();
        cbTipodoc = new javax.swing.JComboBox<>();
        jLabel22 = new javax.swing.JLabel();
        txtCnpj = new javax.swing.JTextField();
        txtChave = new javax.swing.JTextField();
        jLabel23 = new javax.swing.JLabel();
        txtFone = new javax.swing.JTextField();
        jLabel24 = new javax.swing.JLabel();
        jLabel27 = new javax.swing.JLabel();
        txtInscricao = new javax.swing.JTextField();
        btnPesq = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        btnGravar = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jPanel4 = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        txtBaseicms = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        txtValoricms = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        txtBasest = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        txtValorst = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        txtOutdesp = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        txtDescont = new javax.swing.JTextField();
        txtTotalprod = new javax.swing.JTextField();
        jLabel13 = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        txtTotalgeral = new javax.swing.JTextField();
        jLabel16 = new javax.swing.JLabel();
        txtVlIpi = new javax.swing.JTextField();
        jPanel5 = new javax.swing.JPanel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel6 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tbItens = new javax.swing.JTable();
        btnIncluir = new javax.swing.JButton();
        btnExcluir = new javax.swing.JButton();
        btnAlterar = new javax.swing.JButton();
        jPanel7 = new javax.swing.JPanel();
        jLabel28 = new javax.swing.JLabel();
        CbFinalizadora = new javax.swing.JComboBox();
        CbParcelas = new javax.swing.JComboBox<>();
        btnOk = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblParcelas = new javax.swing.JTable();
        txtValortotaldocumento = new javax.swing.JLabel();
        jLabel25 = new javax.swing.JLabel();
        jLabel26 = new javax.swing.JLabel();
        txtTroco = new javax.swing.JLabel();
        jLabel29 = new javax.swing.JLabel();
        txtValorrecebido = new javax.swing.JTextField();
        btnExluirPag = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Visualização de Documento");
        addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentShown(java.awt.event.ComponentEvent evt) {
                formComponentShown(evt);
            }
        });
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));

        jPanel2.setBackground(new java.awt.Color(219, 227, 227));
        jPanel2.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED, new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153)));

        txtMovto.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtMovto.setEnabled(false);

        jLabel1.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel1.setText("Id Mov :");

        jLabel2.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel2.setText("Doc. :");

        txtDocumento.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtDocumento.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtDocumentoActionPerformed(evt);
            }
        });

        jLabel3.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel3.setText("Emissão :");

        jLabel4.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel4.setText("Lançamento :");

        try {
            ftDatemissao.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.MaskFormatter("##/##/####")));
        } catch (java.text.ParseException ex) {
            ex.printStackTrace();
        }
        ftDatemissao.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        ftDatemissao.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                ftDatemissaoFocusGained(evt);
            }
        });
        ftDatemissao.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ftDatemissaoActionPerformed(evt);
            }
        });

        try {
            ftDatlancamento.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.MaskFormatter("##/##/####")));
        } catch (java.text.ParseException ex) {
            ex.printStackTrace();
        }
        ftDatlancamento.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        ftDatlancamento.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ftDatlancamentoActionPerformed(evt);
            }
        });

        jLabel5.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel5.setText("Parceiro:");

        txtIdParceiro.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtIdParceiro.setToolTipText("F10 para pesquisar");
        txtIdParceiro.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtIdParceiroFocusGained(evt);
            }
        });
        txtIdParceiro.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtIdParceiroActionPerformed(evt);
            }
        });

        txtRazaoSocial.setEditable(false);
        txtRazaoSocial.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N

        jLabel6.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel6.setText("Serie :");

        txtSerie.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtSerie.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtSerieActionPerformed(evt);
            }
        });

        jLabel15.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel15.setText("Tipo :");

        cbTipodoc.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        cbTipodoc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbTipodocActionPerformed(evt);
            }
        });

        jLabel22.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel22.setText("Cnpj :");

        txtCnpj.setEditable(false);
        txtCnpj.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N

        txtChave.setEditable(false);
        txtChave.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N

        jLabel23.setFont(new java.awt.Font("Arial", 0, 12)); // NOI18N
        jLabel23.setText("Ie:");

        txtFone.setEditable(false);
        txtFone.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N

        jLabel24.setFont(new java.awt.Font("Arial", 0, 12)); // NOI18N
        jLabel24.setText("Fone :");

        jLabel27.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel27.setText("Chave:");

        txtInscricao.setEditable(false);
        txtInscricao.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtInscricao.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtInscricaoActionPerformed(evt);
            }
        });

        btnPesq.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/procura.png"))); // NOI18N
        btnPesq.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPesqActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel5)
                    .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel27, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel22, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(txtCnpj, javax.swing.GroupLayout.PREFERRED_SIZE, 125, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(jLabel23)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtInscricao, javax.swing.GroupLayout.PREFERRED_SIZE, 145, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(txtMovto, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jLabel2)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtDocumento, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jLabel6)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtSerie, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(jLabel15)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cbTipodoc, javax.swing.GroupLayout.PREFERRED_SIZE, 133, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(txtChave))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel3, javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.TRAILING))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(ftDatlancamento, javax.swing.GroupLayout.DEFAULT_SIZE, 89, Short.MAX_VALUE)
                                    .addComponent(ftDatemissao)))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel24)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtFone, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(txtIdParceiro, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(btnPesq, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(txtRazaoSocial, javax.swing.GroupLayout.PREFERRED_SIZE, 523, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(7, 7, 7))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(txtMovto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2)
                    .addComponent(txtDocumento, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3)
                    .addComponent(ftDatemissao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6)
                    .addComponent(txtSerie, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbTipodoc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel15))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(ftDatlancamento, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtChave, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel27))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel5)
                        .addComponent(txtIdParceiro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(txtRazaoSocial, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btnPesq, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel22)
                    .addComponent(txtCnpj, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel23)
                    .addComponent(jLabel24)
                    .addComponent(txtFone, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtInscricao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel3.setBackground(new java.awt.Color(219, 227, 227));
        jPanel3.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED, new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153)));

        btnGravar.setFont(new java.awt.Font("Segoe UI Semibold", 0, 14)); // NOI18N
        btnGravar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/Confirma.png"))); // NOI18N
        btnGravar.setText("Gravar");
        btnGravar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGravarActionPerformed(evt);
            }
        });

        jButton2.setFont(new java.awt.Font("Segoe UI Semibold", 0, 14)); // NOI18N
        jButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/Cancela.png"))); // NOI18N
        jButton2.setText("Cancelar");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel3Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(btnGravar, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(25, 25, 25))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnGravar)
                    .addComponent(jButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 36, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel3Layout.linkSize(javax.swing.SwingConstants.VERTICAL, new java.awt.Component[] {btnGravar, jButton2});

        jPanel4.setBackground(new java.awt.Color(251, 186, 194));
        jPanel4.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED, new java.awt.Color(153, 0, 0), new java.awt.Color(153, 0, 0), new java.awt.Color(153, 0, 0), new java.awt.Color(153, 0, 0)));

        jLabel7.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel7.setText("Base Icms :");

        txtBaseicms.setEditable(false);
        txtBaseicms.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtBaseicms.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtBaseicms.setText("0,00");

        jLabel8.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel8.setText("Valor Icms :");

        txtValoricms.setEditable(false);
        txtValoricms.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtValoricms.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtValoricms.setText("0,00");

        jLabel9.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel9.setText("Base ST Icms :");

        txtBasest.setEditable(false);
        txtBasest.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtBasest.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtBasest.setText("0,00");

        jLabel10.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel10.setText("Valor ST Icms :");

        txtValorst.setEditable(false);
        txtValorst.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtValorst.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtValorst.setText("0,00");
        txtValorst.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtValorstFocusLost(evt);
            }
        });

        jLabel11.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel11.setText("Outras Despesas :");

        txtOutdesp.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtOutdesp.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtOutdesp.setText("0,00");
        txtOutdesp.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtOutdespFocusLost(evt);
            }
        });
        txtOutdesp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtOutdespActionPerformed(evt);
            }
        });

        jLabel12.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel12.setText("Descontos :");

        txtDescont.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtDescont.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtDescont.setText("0,00");
        txtDescont.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtDescontFocusLost(evt);
            }
        });
        txtDescont.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtDescontActionPerformed(evt);
            }
        });

        txtTotalprod.setEditable(false);
        txtTotalprod.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtTotalprod.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtTotalprod.setText("0,00");

        jLabel13.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel13.setText("Totais Produtos :");

        jLabel14.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel14.setText("Totais Nota :");

        txtTotalgeral.setEditable(false);
        txtTotalgeral.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtTotalgeral.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtTotalgeral.setText("0,00");

        jLabel16.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel16.setText("Valor IPI:");

        txtVlIpi.setEditable(false);
        txtVlIpi.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        txtVlIpi.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txtVlIpi.setText("0,00");
        txtVlIpi.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtVlIpiFocusLost(evt);
            }
        });

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel7, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel8, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel9, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel10, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txtBaseicms, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 75, Short.MAX_VALUE)
                    .addComponent(txtValoricms, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(txtBasest, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(txtValorst, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel4Layout.createSequentialGroup()
                        .addComponent(jLabel16)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtVlIpi, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel4Layout.createSequentialGroup()
                            .addComponent(jLabel12)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                            .addComponent(txtDescont, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(jPanel4Layout.createSequentialGroup()
                            .addComponent(jLabel11)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(txtOutdesp, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel13)
                    .addComponent(jLabel14))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txtTotalprod, javax.swing.GroupLayout.PREFERRED_SIZE, 76, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtTotalgeral, javax.swing.GroupLayout.PREFERRED_SIZE, 76, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(txtBaseicms, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel11)
                    .addComponent(txtOutdesp, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel13)
                    .addComponent(txtTotalprod, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(txtValoricms, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel12)
                    .addComponent(txtDescont, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel14)
                    .addComponent(txtTotalgeral, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel16)
                        .addComponent(txtVlIpi, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel9)
                        .addComponent(txtBasest, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel10)
                    .addComponent(txtValorst, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel5.setBackground(new java.awt.Color(255, 255, 255));
        jPanel5.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED, new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153), new java.awt.Color(0, 0, 153)));

        jTabbedPane1.setBackground(new java.awt.Color(219, 227, 227));
        jTabbedPane1.setFont(new java.awt.Font("Segoe UI Semibold", 0, 12)); // NOI18N

        jPanel6.setBackground(new java.awt.Color(219, 227, 227));

        tbItens.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        tbItens.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "id prod", "Cod Fab.", "Id item", "Ean Comercial", "Cod. Barra", "Descrição", "Qtde Comercial", "Qtde", "Unidade", "Preço Unit", "Desconto", "Acresc", "Sub Total", "Total", "VL St", "VL Icms", "VL Ipi", "VL Pis", "VL Cofins", "Cst"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tbItens.setAutoResizeMode(javax.swing.JTable.AUTO_RESIZE_OFF);
        tbItens.setColumnSelectionAllowed(true);
        tbItens.setRowHeight(20);
        tbItens.getTableHeader().setReorderingAllowed(false);
        jScrollPane1.setViewportView(tbItens);
        tbItens.getColumnModel().getSelectionModel().setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        if (tbItens.getColumnModel().getColumnCount() > 0) {
            tbItens.getColumnModel().getColumn(0).setPreferredWidth(80);
            tbItens.getColumnModel().getColumn(1).setPreferredWidth(100);
            tbItens.getColumnModel().getColumn(2).setPreferredWidth(80);
            tbItens.getColumnModel().getColumn(3).setMinWidth(50);
            tbItens.getColumnModel().getColumn(3).setPreferredWidth(120);
            tbItens.getColumnModel().getColumn(4).setPreferredWidth(120);
            tbItens.getColumnModel().getColumn(5).setPreferredWidth(300);
            tbItens.getColumnModel().getColumn(7).setPreferredWidth(70);
            tbItens.getColumnModel().getColumn(8).setPreferredWidth(50);
            tbItens.getColumnModel().getColumn(9).setPreferredWidth(70);
            tbItens.getColumnModel().getColumn(10).setPreferredWidth(70);
            tbItens.getColumnModel().getColumn(11).setPreferredWidth(70);
            tbItens.getColumnModel().getColumn(12).setPreferredWidth(90);
            tbItens.getColumnModel().getColumn(13).setPreferredWidth(90);
            tbItens.getColumnModel().getColumn(14).setPreferredWidth(100);
            tbItens.getColumnModel().getColumn(15).setPreferredWidth(100);
            tbItens.getColumnModel().getColumn(16).setPreferredWidth(100);
            tbItens.getColumnModel().getColumn(17).setPreferredWidth(100);
            tbItens.getColumnModel().getColumn(18).setPreferredWidth(100);
            tbItens.getColumnModel().getColumn(19).setPreferredWidth(80);
        }

        btnIncluir.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        btnIncluir.setText("Incluir");
        btnIncluir.setPreferredSize(new java.awt.Dimension(75, 23));
        btnIncluir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnIncluirActionPerformed(evt);
            }
        });

        btnExcluir.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        btnExcluir.setText("Excluir");
        btnExcluir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnExcluirActionPerformed(evt);
            }
        });

        btnAlterar.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        btnAlterar.setText("Alterar");
        btnAlterar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAlterarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1)
                    .addGroup(jPanel6Layout.createSequentialGroup()
                        .addComponent(btnIncluir, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnAlterar)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnExcluir)
                        .addGap(0, 1009, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addGap(1, 1, 1)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnIncluir, javax.swing.GroupLayout.PREFERRED_SIZE, 15, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnExcluir)
                    .addComponent(btnAlterar))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 310, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel6Layout.linkSize(javax.swing.SwingConstants.VERTICAL, new java.awt.Component[] {btnAlterar, btnExcluir, btnIncluir});

        jTabbedPane1.addTab("Produtos", jPanel6);

        jPanel7.setBackground(new java.awt.Color(219, 227, 227));
        jPanel7.addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentShown(java.awt.event.ComponentEvent evt) {
                jPanel7ComponentShown(evt);
            }
        });

        jLabel28.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        jLabel28.setText("Finalizadora :");

        CbFinalizadora.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        CbFinalizadora.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CbFinalizadoraActionPerformed(evt);
            }
        });

        CbParcelas.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        CbParcelas.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24" }));
        CbParcelas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CbParcelasActionPerformed(evt);
            }
        });

        btnOk.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        btnOk.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/Incluir.png"))); // NOI18N
        btnOk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOkActionPerformed(evt);
            }
        });

        tblParcelas.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Data", "Id Finalizadora", "Finalizadora", "Parcela", "Valor", "Vencimento"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, true, true
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblParcelas.setAutoResizeMode(javax.swing.JTable.AUTO_RESIZE_OFF);
        tblParcelas.getTableHeader().setReorderingAllowed(false);
        jScrollPane2.setViewportView(tblParcelas);
        if (tblParcelas.getColumnModel().getColumnCount() > 0) {
            tblParcelas.getColumnModel().getColumn(0).setPreferredWidth(110);
            tblParcelas.getColumnModel().getColumn(1).setPreferredWidth(150);
            tblParcelas.getColumnModel().getColumn(2).setResizable(false);
            tblParcelas.getColumnModel().getColumn(2).setPreferredWidth(150);
            tblParcelas.getColumnModel().getColumn(3).setResizable(false);
            tblParcelas.getColumnModel().getColumn(3).setPreferredWidth(70);
            tblParcelas.getColumnModel().getColumn(4).setPreferredWidth(100);
            tblParcelas.getColumnModel().getColumn(5).setPreferredWidth(110);
        }

        txtValortotaldocumento.setFont(new java.awt.Font("Arial", 1, 16)); // NOI18N
        txtValortotaldocumento.setForeground(new java.awt.Color(255, 51, 0));
        txtValortotaldocumento.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        txtValortotaldocumento.setText("0,00");

        jLabel25.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        jLabel25.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel25.setText("   Total R$:");

        jLabel26.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        jLabel26.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel26.setText(" Troco R$:");

        txtTroco.setFont(new java.awt.Font("Arial", 1, 16)); // NOI18N
        txtTroco.setForeground(new java.awt.Color(255, 0, 51));
        txtTroco.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        txtTroco.setText("0,00");

        jLabel29.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        jLabel29.setText("Valor R$:");

        btnExluirPag.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/Deletar.png"))); // NOI18N
        btnExluirPag.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnExluirPagActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel7Layout.createSequentialGroup()
                        .addComponent(jLabel28)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(CbFinalizadora, javax.swing.GroupLayout.PREFERRED_SIZE, 148, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(CbParcelas, javax.swing.GroupLayout.PREFERRED_SIZE, 61, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(53, 53, 53)
                        .addComponent(jLabel29)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtValorrecebido, javax.swing.GroupLayout.PREFERRED_SIZE, 136, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(24, 24, 24)
                        .addComponent(btnOk, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnExluirPag, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 692, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(jLabel26, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(txtValortotaldocumento, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jLabel25, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 94, Short.MAX_VALUE)
                    .addComponent(txtTroco, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap(448, Short.MAX_VALUE))
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel28)
                        .addComponent(CbFinalizadora, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(CbParcelas, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel29))
                    .addComponent(btnOk, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtValorrecebido, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnExluirPag))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 298, Short.MAX_VALUE)
                    .addGroup(jPanel7Layout.createSequentialGroup()
                        .addComponent(jLabel25)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtValortotaldocumento)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jLabel26)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTroco)
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );

        jTabbedPane1.addTab("Financeiro", jPanel7);

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 1267, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                .addComponent(jTabbedPane1)
                .addContainerGap())
        );

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
       this.dispose();
       itens.clear();
    }//GEN-LAST:event_jButton2ActionPerformed

    private void txtIdParceiroActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtIdParceiroActionPerformed
        this.preencheDadosParceiro(txtIdParceiro.getText());
    }//GEN-LAST:event_txtIdParceiroActionPerformed

    private void btnGravarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnGravarActionPerformed
        this.validaDados();
    }//GEN-LAST:event_btnGravarActionPerformed

    private void cbTipodocActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbTipodocActionPerformed
        LancamentoDocumentos.tipomovto=clsaux.retornaId(cbTipodoc.getSelectedItem().toString().trim());
    }//GEN-LAST:event_cbTipodocActionPerformed

    private void formComponentShown(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_formComponentShown
        if (estadoform.equals("I")){
            this.dadosInsercao();
        }else if (estadoform.equals("A")){
            this.carregaDadosAlterar(idmovimento);
            if(clsaux.retornaId(cbTipodoc.getSelectedItem().toString()).equals("3")){
               
            }else{
                 this.validaCampoJanela();
            }
        }
    }//GEN-LAST:event_formComponentShown

    private void txtOutdespFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtOutdespFocusLost
        LancamentoDocumentos.calculaTotalDoc();
    }//GEN-LAST:event_txtOutdespFocusLost

    private void txtDescontFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtDescontFocusLost
       LancamentoDocumentos.calculaTotalDoc();
    }//GEN-LAST:event_txtDescontFocusLost

    private void txtValorstFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtValorstFocusLost
        LancamentoDocumentos.calculaTotalDoc();
    }//GEN-LAST:event_txtValorstFocusLost

    private void txtInscricaoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtInscricaoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtInscricaoActionPerformed

    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
      itens.clear();
    }//GEN-LAST:event_formWindowClosing

    private void jPanel7ComponentShown(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_jPanel7ComponentShown
        this.carregaInfFinanceiro();
    }//GEN-LAST:event_jPanel7ComponentShown

    private void btnExluirPagActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnExluirPagActionPerformed
        this.excluiFinalizadora();
    }//GEN-LAST:event_btnExluirPagActionPerformed

    private void btnOkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOkActionPerformed
        this.calculaValoresFinanceiro();
       
    }//GEN-LAST:event_btnOkActionPerformed

    private void CbParcelasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CbParcelasActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CbParcelasActionPerformed

    private void CbFinalizadoraActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CbFinalizadoraActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CbFinalizadoraActionPerformed

    private void txtIdParceiroFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtIdParceiroFocusGained
        
    }//GEN-LAST:event_txtIdParceiroFocusGained

    private void txtDocumentoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtDocumentoActionPerformed
       txtSerie.requestFocus();
    }//GEN-LAST:event_txtDocumentoActionPerformed

    private void txtSerieActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtSerieActionPerformed
      ftDatemissao.requestFocus();
    }//GEN-LAST:event_txtSerieActionPerformed

    private void ftDatemissaoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ftDatemissaoActionPerformed
        ftDatlancamento.requestFocus();
    }//GEN-LAST:event_ftDatemissaoActionPerformed

    private void ftDatlancamentoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ftDatlancamentoActionPerformed
       txtIdParceiro.requestFocus();
    }//GEN-LAST:event_ftDatlancamentoActionPerformed

    private void btnExcluirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnExcluirActionPerformed
        this.excluiItem();
    }//GEN-LAST:event_btnExcluirActionPerformed

    private void btnIncluirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnIncluirActionPerformed
        LancamentoDocumentos.tipomovto=clsaux.retornaId(cbTipodoc.getSelectedItem().toString().trim());
        LancamentoItemDocumento dialog = new LancamentoItemDocumento(new javax.swing.JFrame(), true);
        LancamentoItemDocumento.item=preparaNovoItem();
        LancamentoItemDocumento.estadoform="O";
        dialog.setVisible(true);
    }//GEN-LAST:event_btnIncluirActionPerformed

    private void btnAlterarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAlterarActionPerformed
       this.alteraItem();
    }//GEN-LAST:event_btnAlterarActionPerformed

    private void txtVlIpiFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtVlIpiFocusLost
        // TODO add your handling code here:
    }//GEN-LAST:event_txtVlIpiFocusLost

    private void ftDatemissaoFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_ftDatemissaoFocusGained
        // TODO add your handling code here:
    }//GEN-LAST:event_ftDatemissaoFocusGained

    private void btnPesqActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPesqActionPerformed
        formProcuraCliente dialo = new formProcuraCliente(new javax.swing.JFrame(), true);
                formProcuraCliente.idform="2";
                dialo.setVisible(true);
    }//GEN-LAST:event_btnPesqActionPerformed

    private void txtOutdespActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtOutdespActionPerformed
      rateiaDescontoAcrescimoItens();
    }//GEN-LAST:event_txtOutdespActionPerformed

    private void txtDescontActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtDescontActionPerformed
       rateiaDescontoAcrescimoItens();
    }//GEN-LAST:event_txtDescontActionPerformed
    public void inicializa(){
        DefaultComboBoxModel cbtip= new DefaultComboBoxModel(listaDAO.listaTipoDocumento().toArray());
        cbTipodoc.setModel(cbtip); 
        //txtRazaoSocial.setText("Pressione F10 No Campo Parceiro Para Localizar");
        InputMap imp= this.getRootPane().getInputMap(JPanel.WHEN_IN_FOCUSED_WINDOW);
        imp.put(KeyStroke.getKeyStroke(KeyEvent.VK_F10,0),"busca");
        imp.put(KeyStroke.getKeyStroke(KeyEvent.VK_F1,0),"inserirItem");
        imp.put(KeyStroke.getKeyStroke(KeyEvent.VK_F6,0),"gravar");
        this.getRootPane().setInputMap(JPanel.WHEN_IN_FOCUSED_WINDOW, imp);
        this.getRootPane().getActionMap().put("busca", new AbstractAction(){
            public void actionPerformed(ActionEvent ev){
                formProcuraCliente dialo = new formProcuraCliente(new javax.swing.JFrame(), true);
                formProcuraCliente.idform="2";
                dialo.setVisible(true);
            }
        });
         this.getRootPane().getActionMap().put("inserirItem", new AbstractAction(){
            public void actionPerformed(ActionEvent ev){
                 LancamentoDocumentos.tipomovto=clsaux.retornaId(cbTipodoc.getSelectedItem().toString().trim());
                LancamentoItemDocumento dialog = new LancamentoItemDocumento(new javax.swing.JFrame(), true);
                LancamentoItemDocumento.item=preparaNovoItem();
                LancamentoItemDocumento.estadoform="O";
                dialog.setVisible(true);
            }
        });
          this.getRootPane().getActionMap().put("gravar", new AbstractAction(){
            public void actionPerformed(ActionEvent ev){
                validaDados();
            }
        });
          
           tbItens.addMouseListener(new MouseAdapter(){
            public void mouseClicked(MouseEvent e ){
                if (e.getClickCount()==2){
                  alteraItem();
                } 
            }
          
        }); 
          
          // funcao valida a data digitada na tabela de pagamentos- data vencimento
            tblParcelas.getColumnModel().getColumn(5).setCellEditor(validaDataTabela.validaDataDiaMesAno());
        
    }
    public void dadosInsercao(){
        DefaultComboBoxModel cbtip= new DefaultComboBoxModel(listaDAO.listaTipoDocumento().toArray());
        cbTipodoc.setModel(cbtip); 
        cbTipodoc.setSelectedItem("3- Compras");
        //ftDatemissao.setText(clsaux.preencheData());
        //ftDatlancamento.setText(clsaux.preencheData());
        idmovimento=lancDocumentDAO.insereRegistroBranco("0");
        txtMovto.setText(idmovimento);
        if (clsaux.verificaNulo(txtIdParceiro.getText())==false)this.preencheDadosParceiro(txtIdParceiro.getText());
       
    }
    public void preencheDadosParceiro(String id){
        String sql="select tp.idparceiro,\n" +
                    "        tp.cnpj,\n" +
                    "        tp.razao_social,\n" +
                    "        tp.inscricao_estadual,\n" +
                    "        tp.fone from\n" +
                    " tparceiros tp where tp.idparceiro=?";
        PreparedStatement ps = conexao.getPreparedStatementResult(sql);
        try {
            ps.setString(1, id);
            ResultSet rs = ps.executeQuery();
            rs.first();
            txtRazaoSocial.setText(rs.getString(3));
            txtCnpj.setText(rs.getString(2));
            txtInscricao.setText(rs.getString(4));
            txtFone.setText(rs.getString(5));
            rs.close();
            ps.close();
            btnIncluir.requestFocus();
        } catch (SQLException ex) {
            Logger.getLogger(LancamentoDocumentos.class.getName()).log(Level.SEVERE, null, ex);
            JOptionPane.showMessageDialog(null, "Parceiro Não Encontrado!!!");
        }
        
    }
    public void gravaRegistro(){
        clsLancDocCabecalho cd= new clsLancDocCabecalho();
        lancDocumentDAO ldDAO= new lancDocumentDAO();
        cd.setIdmovimento(txtMovto.getText());
        cd.setDocument(txtDocumento.getText());
        cd.setSerie(txtSerie.getText());
        cd.setEmissao(clsaux.retornaData(ftDatemissao.getText()));
        cd.setLancamento(clsaux.retornaData(ftDatlancamento.getText()));
        cd.setIdparceiro(txtIdParceiro.getText());
        cd.setBaseicms(txtBaseicms.getText().replaceAll(",", "."));
        cd.setValoricms(txtValoricms.getText().replaceAll(",", "."));
        cd.setBasest(txtBasest.getText().replaceAll(",", "."));
        cd.setValorst(txtValorst.getText().replaceAll(",", "."));
        cd.setOutrasdesp(txtOutdesp.getText().replaceAll(",", "."));
        cd.setDesconto(txtDescont.getText().replaceAll(",", "."));
        cd.setTotalprod(txtTotalprod.getText().replaceAll(",", "."));
        cd.setTotal(txtTotalgeral.getText().replaceAll(",", "."));
        cd.setValoripi(clsaux.capturaValor(txtVlIpi.getText()));
        cd.setChaveacesso(txtChave.getText());
        cd.setTipomovimento(clsaux.retornaId(cbTipodoc.getSelectedItem().toString()));
        ldDAO.atualizaRegistroMovto(cd);
        this.gravarItens();
        this.gravaFinanceiro(idmovimento);
        itens.clear();
        this.dispose();
    }
    
    public void gravarItens(){
        lancDocumentDAO ldDAO= new lancDocumentDAO();
        for (int i=0; i< itens.size(); i++){
            itens.get(i).setIdmovto(txtMovto.getText());
            ldDAO.insereItensReferenteMovto(itens.get(i));
            if(tipomovto.equals("3")){
               if(custosDAO.verificarUltimoLancamentoItem(idmovimento, itens.get(i).getBarras())){
                    custosDAO.atualizaCustoAtual(clsaux.capturaValor(itens.get(i).getCusto()), itens.get(i).getIdproduto());
              }
                
            }
        }
    }
    public static void calculaTotalDoc(){
        int lin=tbItens.getRowCount();
        Double valor=0.00,total=0.00;
        Double desconto=0.00;
        Double acres=0.00,outrasdesp=0.00,icmsst=0.00,vlpis=0.00,vlcofins=0.00,seguro=0.00,frete=0.00,ipi=0.00;
       /* for (int i=0; i<lin; i++){
            valor=valor+Double.parseDouble(tbItens.getValueAt(i, 9).toString().replaceAll(",","."));
            desconto=desconto+Double.parseDouble(tbItens.getValueAt(i, 7).toString().replaceAll(",", "."));
            acres=acres+Double.parseDouble(tbItens.getValueAt(i, 8).toString().replaceAll(",", "."));
            
            
        }*/
        for(clsLancDocument tempo : itens){
             valor=valor+ clsaux.capturaValores(tempo.getSubtotal());
             desconto=desconto+ clsaux.capturaValores(tempo.getDesconto());
             acres=acres+ clsaux.capturaValores(tempo.getAcrescimo());
             outrasdesp=outrasdesp+clsaux.capturaValores(tempo.getValor_outras());
             seguro=seguro+clsaux.capturaValores(tempo.getValor_seguro());
             frete=frete+clsaux.capturaValores(tempo.getValor_frete());
             ipi=ipi+clsaux.capturaValores(tempo.getValor_ipi());
             total=total+clsaux.capturaValores(tempo.getTotal());
        }
        acres=acres+outrasdesp+seguro+frete;
        txtTotalprod.setText(clsaux.formato(valor));
        txtDescont.setText(clsaux.formato(desconto));
        txtOutdesp.setText(clsaux.formato(acres));
        txtVlIpi.setText(clsaux.formato(ipi));
        
        //desconto=Double.parseDouble(txtDescont.getText().replaceAll(",", "."));
        //acres=Double.parseDouble(txtOutdesp.getText().replaceAll(",", "."));
        //total=valor+icmsst+outrasdesp+ipi;
        txtTotalgeral.setText(clsaux.formato(total));
        txtValortotaldocumento.setText(clsaux.formato(total));
        
    }
    public static void rateiaDescontoAcrescimoItens(){
        Double valordesconto=clsaux.capturaValores(txtDescont.getText());
        Double valoracrescimo=clsaux.capturaValores(txtOutdesp.getText());
        Double totalger=clsaux.capturaValores(txtTotalgeral.getText());
        Double perc=valordesconto*100/totalger;
        Double percoutras=valoracrescimo*100/totalger;
        Double vlite=0.00;
        Double vliteout=0.00;
        Double total=0.00;
        Double custo=0.00;
        for(int i=0; i<itens.size();i++){
            vlite=clsaux.capturaValores(clsaux.formato(clsaux.capturaValores(itens.get(i).getTotal())*perc/100.0));
            vliteout=clsaux.capturaValores(clsaux.formato(clsaux.capturaValores(itens.get(i).getTotal())*percoutras/100.0));
           if(valordesconto>=vlite){
                 itens.get(i).setDesconto(vlite.toString());
                 valordesconto=clsaux.capturaValores(clsaux.formato(valordesconto-vlite));
                
            }else{
                itens.get(i).setDesconto(valordesconto.toString());
            }
           
           if(valoracrescimo>=vliteout){
                itens.get(i).setAcrescimo(vliteout.toString());
                 valoracrescimo=clsaux.capturaValores(clsaux.formato(valoracrescimo-vliteout));
           }else{
                itens.get(i).setAcrescimo(valoracrescimo.toString());
           }
            total= clsaux.capturaValores(itens.get(i).getSubtotal()) +clsaux.capturaValores(itens.get(i).getAcrescimo())+clsaux.capturaValores(itens.get(i).getValor_frete())+
                    clsaux.capturaValores(itens.get(i).getValor_ipi())+clsaux.capturaValores(itens.get(i).getValor_seguro())+clsaux.capturaValores(itens.get(i).getValor_outras())-
                    clsaux.capturaValores(itens.get(i).getDesconto());
            custo=total/(clsaux.capturaValores(itens.get(i).getQuantidade())*clsaux.capturaValores(itens.get(i).getFator()));
            itens.get(i).setTotal(total.toString());
            itens.get(i).setCusto(custo.toString());
            
        }
    
        populaTabelaItens();
        
    }
    
    public void carregaDadosAlterar(String idmov){
        clsLancDocCabecalho ld = new clsLancDocCabecalho();
        lancDocumentDAO ldDAO= new lancDocumentDAO();
        ld.setIdmovimento(idmov);
        ldDAO.buscaCabecalhoDoc(ld);
        txtMovto.setText(ld.getIdmovimento());
        txtDocumento.setText(ld.getDocument());
        txtSerie.setText(ld.getSerie());
        txtIdParceiro.setText(ld.getIdparceiro());
        txtBaseicms.setText(clsaux.formato(clsaux.capturaValores(ld.getBaseicms())));
        txtValoricms.setText(clsaux.formato(clsaux.capturaValores(ld.getValoricms())));
        txtBasest.setText(clsaux.formato(clsaux.capturaValores(ld.getBasest())));
        txtValorst.setText(clsaux.formato(clsaux.capturaValores(ld.getValorst())));
        txtOutdesp.setText(clsaux.formato(clsaux.capturaValores(ld.getOutrasdesp())));
        txtDescont.setText(clsaux.formato(clsaux.capturaValores(ld.getDesconto())));
        txtTotalprod.setText(clsaux.formato(clsaux.capturaValores(ld.getTotalprod())));
        txtTotalgeral.setText(clsaux.formato(clsaux.capturaValores(ld.getTotal())));
        txtVlIpi.setText(clsaux.formato(clsaux.capturaValores(ld.getValoripi())));
        ftDatemissao.setText(clsaux.convertDataExib(ld.getEmissao().toString()));
        ftDatlancamento.setText(clsaux.convertDataExib(ld.getLancamento().toString()));
        cbTipodoc.setSelectedItem(ld.getTipomovimento());
        txtChave.setText(ld.getChaveacesso());
        itens=ldDAO.buscaItens(idmovimento);
        populaTabelaItens();
        this.carregaDadosFinanceiro(idmovimento);
        this.preencheDadosParceiro(txtIdParceiro.getText());
     }
    public void validaCampoJanela(){
        btnIncluir.setEnabled(false);
        btnAlterar.setEnabled(false);
        btnExcluir.setEnabled(false);
       
        txtDocumento.setEnabled(false);
        txtSerie.setEnabled(false);
        cbTipodoc.setEnabled(false);
        btnOk.setEnabled(false);
        btnExluirPag.setEnabled(false);
        txtValorrecebido.setEnabled(false);
    }
    public void carregaDadosFinanceiro(String mov){
        try {
            String sql="select tm.data,tm.valor_recebido,tm.id_finalizadora,tm.sequencia_finalizadora, tf.descricao,tm.vencimento\n" +
                        "from tpagamentos_adm tm\n" +
                        "join tfinalizadora tf on tm.id_finalizadora=tf.id_finalizdora\n" +
                        "where tm.id_mov=? and tm.estado<>3";
            if(clsaux.retornaId(cbTipodoc.getSelectedItem()).equals("1")){
                sql="select tm1.dat_finalizacao,(tm.valor-tm.troco),tm.id_finalizadora,tm.id_pag, tf.descricao,tm1.dat_finalizacao\n" +
"                        from tpagamentos_pdv tm\n" +
"                        join tmovimento tm1 on tm1.id_mov=tm.id_movimento\n" +
"                        join tfinalizadora tf on tm.id_finalizadora=tf.id_finalizdora\n" +
"                        where tm.id_movimento=? and tm.estado<>3";
            }
            PreparedStatement ps = conexao.getPreparedStatement(sql);
            ps.setString(1, mov);
            ResultSet rs = ps.executeQuery();
            DefaultTableModel tb = (DefaultTableModel) tblParcelas.getModel();
            tb.setNumRows(0);
            while(rs.next()){
                tb.addRow(new Object[]{
                    clsaux.convertDataExib(rs.getString(1)),
                    rs.getString(3),
                    rs.getString(5),
                    rs.getString(4),
                    clsaux.formato(rs.getDouble(2)),
                    clsaux.convertDataExib(rs.getString(6))
                });
            }
        } catch (SQLException ex) {
            Logger.getLogger(LancamentoDocumentos.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    public void validaDados(){
        String doc,ser=null;
        doc=txtDocumento.getText();
        ser=txtSerie.getText();
       if(doc.equals("")||ser.equals("")){
           JOptionPane.showMessageDialog(null, "Falta preencher os campos Documento ou Serie!!!");
       }else if(ftDatemissao.getText().equals("  /  /    ")||ftDatlancamento.getText().equals("  /  /    ")){
           JOptionPane.showMessageDialog(null, "Data Invalida!!!");
       }else {
           this.gravaRegistro();
       }
    }
    public void alteraItem(){
        LancamentoDocumentos.tipomovto=clsaux.retornaId(cbTipodoc.getSelectedItem().toString().trim());
        LancamentoItemDocumento dialog = new LancamentoItemDocumento(new javax.swing.JFrame(), true);
        LancamentoItemDocumento.linha= tbItens.getSelectedRow();
        LancamentoItemDocumento.item=itens.get(tbItens.getSelectedRow());
        LancamentoItemDocumento.estadoform="A";
        dialog.pegaItem(LancamentoItemDocumento.item.getBarras());
        dialog.setVisible(true);
    }
    public void excluiItem(){
        int yn= JOptionPane.showConfirmDialog(null, "Deseja realmente excluir o registro selecionado?", "exclusão de registro", JOptionPane.YES_NO_OPTION);
        if (yn== JOptionPane.YES_OPTION){
            String idite=tbItens.getValueAt(tbItens.getSelectedRow(), 2).toString();
            lancDocumentDAO.excluirItem(idite, idmovimento);
            itens.remove(tbItens.getSelectedRow());
            this.populaTabelaItens();
            LancamentoDocumentos.calculaTotalDoc();
        }
        
    }
    public String verificaItemCadastrado(String codigobarras){
        String idprodutoretorno="0";
        try {
            
            clsLocalizaProduto localiza= new clsLocalizaProduto();
            localiza.setCodibarra(codigobarras);
            produtoDAO.buscaProduto(localiza);
            
            if(localiza==null){
                idprodutoretorno="0";
            }else{
                idprodutoretorno=localiza.getIdproduto();
            }    
            
        } catch (SQLException ex) {
            Logs.gravarLog.gravaSemMensagem(ex.getMessage());
            System.out.println("Produto Sem Cadastro!!!");
        }
        return idprodutoretorno;
    }
    public static void informaItensSemCadastro(){
        tbItens.setDefaultRenderer(Object.class, new DefaultTableCellRenderer(){
            public Component getTableCellRendererComponent(JTable table, Object value, boolean isSelected, boolean hasFocus, int row, int column) {
            super.getTableCellRendererComponent(table, value, isSelected,hasFocus, row, column);
            String desc=(String) tbItens.getValueAt(row, 0);
            if (desc.trim().equals("0")){
                setForeground(Color.red);
            } else {
                setForeground(Color.black);
            }
            return this;
            }
         });
     }
    public clsLancDocument preparaNovoItem(){
        clsLancDocument novo= new clsLancDocument();
            novo.setCodfornecedor("0000");
            novo.setDescricaofornecedor("");
            novo.setBarras("");
            novo.setIdmovto(idmovimento);
            novo.setAcrescimo("0,00");
            novo.setDesconto("0,00");
            novo.setNumeroitem(String.valueOf(numeitem));
            novo.setPrecovenda("0,00");
            novo.setQuantidade("1,00");
            novo.setQntComercial("0.00");
            novo.setTotal("0,00");
            novo.setUnidade("Un");
            novo.setIdproduto("0");
            novo.setValor_outras("0,00");
            novo.setValor_seguro("0,00");
            novo.setValor_frete("0,00");
            novo.setNcm("0");
            novo.setCst("102");
            novo.setOrigem_produto("0");
            novo.setModbc("3");
            novo.setBase_icms("0,00");
            novo.setAliq_icms("0,00");
            novo.setValor_icms("0,00");
            novo.setValor_st("0,00");
            novo.setBase_st("0,00");
            novo.setPis_cofins("99");
            novo.setAliq_pis("0,00");
            novo.setAliq_cofins("0,00");
            novo.setAliq_ipi("0,00");
            novo.setBase_ipi("0,00");
            novo.setBase_pis("0,00");
            novo.setValor_ipi("0,00");
            novo.setCstipi("99");
            novo.setFator("1,00");
        return novo;
    } 
    
    /*funcões referente ao financeiro do lancamento do documento*/
    public void carregaInfFinanceiro(){
        DefaultComboBoxModel tbfi= new DefaultComboBoxModel(listaDAO.listapagamento().toArray());
        CbFinalizadora.setModel(tbfi);
        txtValortotaldocumento.setText(txtTotalgeral.getText());
        txtValorrecebido.setText(txtValortotaldocumento.getText());
    }
    public void calculaValoresFinanceiro(){
        String idfinalizadora=clsaux.retornaId(CbFinalizadora.getSelectedItem().toString());
        String nomefinalizadora=clsaux.retornaAposId(CbFinalizadora.getSelectedItem().toString());
        int parcela=Integer.parseInt(CbParcelas.getSelectedItem().toString());
        Double valor= Double.parseDouble(txtValorrecebido.getText().replaceAll(",", "."));
        Double totalgeral=Double.parseDouble(txtValortotaldocumento.getText().replaceAll(",", "."));
        DefaultTableModel tbl = (DefaultTableModel) tblParcelas.getModel();
        tbl.setNumRows(0);
        if (parcela==1){
            tbl.addRow(new Object[]{
                clsaux.preencheData(),
                idfinalizadora,
                nomefinalizadora,
                parcela,
                clsaux.formato(valor),
                clsaux.calcularData(30, clsaux.retornaData(clsaux.preencheData()))
            });
        }else if (parcela > 1){
            valor= valor/parcela;
            for (int i=0; i<parcela; i++){
                tbl.addRow(new Object []{
                    clsaux.preencheData(),
                    idfinalizadora,
                     nomefinalizadora,
                      i+1,
                    clsaux.formato(valor),
                    clsaux.calcularData(30*(i+1), clsaux.retornaData(clsaux.preencheData()))
                });
            }
        }
        if(valor>totalgeral){
            txtTroco.setText(clsaux.formato((totalgeral-valor)*-1));
        }
        
    }
    public void gravaFinanceiro(String idmovimentoo){
        CadDocMovConta cd = new CadDocMovConta();
        MovimentoContaDAO mDAO = new MovimentoContaDAO();
        CadContasRecPagar cr = new CadContasRecPagar();
        ContasReceberDAO crDAO= new ContasReceberDAO();
        lancamentoTiroDAO lt= new lancamentoTiroDAO();
        int reg = tblParcelas.getRowCount();
        for (int i=0;i<reg;i++){
            Date data=clsaux.retornaData(tblParcelas.getValueAt(i, 0).toString());
            Date vencimento;
            String dtvenc="";
            try{
                dtvenc=tblParcelas.getValueAt(i, 5).toString();
                vencimento=clsaux.retornaData(dtvenc);
            }catch(Exception e){
                vencimento=clsaux.retornaData(clsaux.preencheData());
            }
            String valor=tblParcelas.getValueAt(i, 4).toString().replaceAll(",", ".");
            int fin= Integer.parseInt(tblParcelas.getValueAt(i, 1).toString());
            String parcela=clsaux.trataCampoNulo(tblParcelas.getValueAt(i, 3).toString());
            lt.insereFinalidoraVenda(String.valueOf(fin), valor, idmovimentoo,parcela,0.00,vencimento);
            if (fin<4){
                cd.setData_lancamento(data);
                cd.setData_venc("current_date");
                cd.setDesc_mov("Saida referente a lancamento de documento");
                cd.setEntrada("0.00");
                cd.setSaida(valor);
                cd.setIdconta("1");
                cd.setIdfinalizadora(String.valueOf(fin));
                cd.setIdparceiro(txtIdParceiro.getText());
                cd.setN_doc(txtDocumento.getText());
                cd.setTipo_mov(clsConfig.financeiro.getTpEntrada());
                cd.setSubtipo_mov(clsConfig.financeiro.getSbEntrada());
                cd.setIdmov(idmovimentoo);
                cd.setParcela(parcela);
                
                mDAO.inserirAlterar(cd);
            }else if (fin>3){
                
                cr.setBanco("1");
                cr.setConta("1");
                cr.setDesconto("0.00");
                cr.setEmisao(data);
                cr.setVencimento(vencimento);
                cr.setEstadotitulo("4");
                cr.setFinan(valor);
                cr.setHistorico("1");
                cr.setIdmovto(idmovimentoo);
                cr.setJuros("0.00");
                cr.setNumero(txtDocumento.getText());
                cr.setParceiro(txtIdParceiro.getText());
                cr.setSaldo(valor);
                cr.setTipo("1");
                cr.setTipo_pag(String.valueOf(fin));
                cr.setValor(valor);
                cr.setVendedor("1");
                cr.setParcela(parcela);
                cr.setTipo_titulo("4");
                cr.setTipofinanceiro(clsConfig.financeiro.getTpEntrada());
                cr.setSubtipofinanceiro(clsConfig.financeiro.getSbEntrada());
                cr.setQntParcelas(parcela);
                crDAO.insereAltera(cr);
                
            }
            
        }
    }
    public void excluiFinalizadora(){
        DefaultTableModel tb = (DefaultTableModel) tblParcelas.getModel();
        String idfinalizadora=tb.getValueAt(tblParcelas.getSelectedRow(), 1).toString();
        String parcela=tb.getValueAt(tblParcelas.getSelectedRow(), 3).toString();
        lancDocumentDAO lc= new lancDocumentDAO();
        lc.excluiFinalizadora(idmovimento, idfinalizadora, parcela);
        tb.removeRow(tblParcelas.getSelectedRow());
    }
    
    
    //funções refente a importação de nfe via xml
    
   
    
    
    public void inciaLeituraNfe(String parceiro){
       // cbTipodoc.setSelectedItem("3- Compras");
       
        try{
        txtChave.setText(inf.getId().replace("NFe", ""));
        txtDocumento.setText(inf.getIde().getNNF());
        txtSerie.setText(inf.getIde().getSerie());
        txtBaseicms.setText(inf.getTotal().getICMSTot().getVBC());
        txtValoricms.setText(inf.getTotal().getICMSTot().getVICMS());
        txtBasest.setText(inf.getTotal().getICMSTot().getVBCST());
        txtValorst.setText(inf.getTotal().getICMSTot().getVST());
        txtOutdesp.setText(inf.getTotal().getICMSTot().getVOutro());
        txtDescont.setText(inf.getTotal().getICMSTot().getVDesc());
        txtTotalprod.setText(inf.getTotal().getICMSTot().getVProd());
        txtTotalgeral.setText(inf.getTotal().getICMSTot().getVNF());
        txtVlIpi.setText(inf.getTotal().getICMSTot().getVIPI());
        ftDatemissao.setText(clsaux.retornaDataUTC(inf.getIde().getDhEmi()));
        ftDatlancamento.setText(clsaux.preencheData());
        
        
        carregaItensXml(inf.getDet(),parceiro);
        carregaDadosFinanceiroXml();
        }catch(Exception er){
            Logs.gravarLog.main(er.getMessage());
        }
        
  }
    private void carregaItensXml(List<TNFe.InfNFe.Det> det,String parc) {
       
        for (int i=0; i<det.size(); i++){
            clsLancDocument ite=new clsLancDocument();
            ite.setCodfornecedor(det.get(i).getProd().getCProd());
            ite.setDescricaofornecedor(det.get(i).getProd().getXProd());
            ite.setBarras(validaDigitosBarras.preencheCodigo(det.get(i).getProd().getCEANTrib()));
            ite.setEanComer(validaDigitosBarras.preencheCodigo(det.get(i).getProd().getCEAN()));
            ite.setIdmovto(idmovimento);
            ite.setAcrescimo(clsaux.trataCampoNulo(det.get(i).getProd().getVOutro()));
            ite.setDesconto(clsaux.trataCampoNulo(det.get(i).getProd().getVDesc()));
            ite.setNumeroitem(String.valueOf(numeitem));
            ite.setPrecovenda(clsaux.formato4(Double.parseDouble(det.get(i).getProd().getVUnTrib())));
            ite.setQuantidade(det.get(i).getProd().getQTrib());
            ite.setQntComercial(det.get(i).getProd().getQCom());
            ite.setSubtotal(det.get(i).getProd().getVProd());
            //ite.setTotal(det.get(i).getProd().getVProd());
            ite.setUnidade(det.get(i).getProd().getUTrib());
            ite.setIdproduto(verificaItemCadastrado(validaDigitosBarras.preencheCodigo(det.get(i).getProd().getCEANTrib())));
            ite.setValor_outras(clsaux.trataCampoNulo(det.get(i).getProd().getVOutro()));
            ite.setValor_seguro(clsaux.trataCampoNulo(det.get(i).getProd().getVSeg()));
            ite.setValor_frete(clsaux.trataCampoNulo(det.get(i).getProd().getVFrete()));
            ite.setNcm(det.get(i).getProd().getNCM());
            ite.setFator("1,00");
            if(!det.get(i).getProd().getQTrib().equals(ite.getQuantidade())){
                Double comercial,tribu=0.00;
                comercial=clsaux.capturaValores(ite.getQuantidade());
                tribu=clsaux.capturaValores(det.get(i).getProd().getQTrib());
                ite.setFator(clsaux.formato(tribu/comercial));
                ite.setPrecovenda(clsaux.formatoNfe(Double.parseDouble(det.get(i).getProd().getVUnTrib())));
            }
            TNFe.InfNFe.Det.Imposto imposto=det.get(i).getImposto();
            TNFe.InfNFe.Det.Imposto.ICMS icms = null;
            TNFe.InfNFe.Det.Imposto.PIS pis = null;
            TNFe.InfNFe.Det.Imposto.COFINS cofins = null;
            TIpi ipi = null;
            for(int l=0; l<imposto.getContent().size(); l++){
                String campo=imposto.getContent().get(l).getName().getLocalPart();
                if(campo.equals("ICMS")){
                    icms= ((TNFe.InfNFe.Det.Imposto.ICMS) imposto.getContent().get(l).getValue());
                }
                else if (campo.equals("PIS")){
                   pis =((TNFe.InfNFe.Det.Imposto.PIS) imposto.getContent().get(l).getValue());
                }
                else if (campo.equals("COFINS")){
                    cofins=((TNFe.InfNFe.Det.Imposto.COFINS) imposto.getContent().get(l).getValue());
                }else if (campo.equals("IPI")){
                    ipi= ((TIpi)imposto.getContent().get(l).getValue());
                }
                    
                
            }
            ite=validaImpostoIcmsCompra(icms, ite);//chama funcao que valida o cst que ta vindo e aplica o metodo correto para coletar informacoes 
            ite=validaImpostoIpiCompra(ipi, ite);
            ite=validaImpostoPisCofinsCompra(pis, cofins, ite);
            Double to=0.00;
            to=clsaux.capturaValores(ite.getSubtotal())+clsaux.capturaValores(ite.getValor_st())+clsaux.capturaValores(ite.getValor_ipi());
            ite.setTotal(clsaux.formato4(to));
            ite.setValor_st(clsaux.trataCampoNulo(ite.getValor_st()));
            ite.setValor_ipi(clsaux.trataCampoNulo(ite.getValor_ipi()));
            ite.setValor_outras(clsaux.trataCampoNulo(ite.getValor_outras()));
            ite.setValor_pis(clsaux.trataCampoNulo(ite.getValor_pis()));
            ite.setValor_cofins(clsaux.trataCampoNulo(ite.getValor_cofins()));
            ite.setValor_icms(clsaux.trataCampoNulo(ite.getValor_icms()));
            ite.setCusto(clsaux.formato4(to/clsaux.capturaValores(ite.getQuantidade())));
            if(clsaux.trataCampoNuloConfig(clsConfig.configuracaogeral.getAssociacaoCompra()).equals("1")){
                produtoDAO dao = new produtoDAO();
                dao.retornaBarrasAssociadoNfCompra(parc, ite);
            }
            itens.add(ite);
            numeitem++;
            System.out.println(ite.getCusto());
        }
        
        populaTabelaItens();
        
        
        
    }
  public clsLancDocument validaImpostoPisCofinsCompra(TNFe.InfNFe.Det.Imposto.PIS pis,TNFe.InfNFe.Det.Imposto.COFINS cofins, clsLancDocument imp ){
        if(pis.getPISNT()!=null){
            imp.setPis_cofins(pis.getPISNT().getCST());
        }else if(pis.getPISOutr()!=null){
            imp.setPis_cofins(pis.getPISOutr().getCST());
            imp.setBase_pis(clsaux.trataCampoNulo(pis.getPISOutr().getVBC()));
            imp.setAliq_pis(clsaux.trataCampoNulo(pis.getPISOutr().getVAliqProd()));
            imp.setValor_pis(clsaux.trataCampoNulo(pis.getPISOutr().getVPIS()));
            
            imp.setAliq_cofins(clsaux.trataCampoNulo(cofins.getCOFINSOutr().getVAliqProd()));
            imp.setValor_cofins(clsaux.trataCampoNulo(cofins.getCOFINSOutr().getVCOFINS()));
        }else if(pis.getPISQtde()!=null){
            imp.setPis_cofins(pis.getPISQtde().getCST());
            imp.setAliq_pis(clsaux.trataCampoNulo(pis.getPISQtde().getVAliqProd()));
            imp.setBase_pis(clsaux.trataCampoNulo(pis.getPISQtde().getQBCProd()));
            imp.setValor_pis(clsaux.trataCampoNulo(pis.getPISQtde().getVPIS()));
            
            imp.setAliq_cofins(clsaux.trataCampoNulo(cofins.getCOFINSQtde().getVAliqProd()));
            imp.setValor_cofins(clsaux.trataCampoNulo(cofins.getCOFINSQtde().getVCOFINS()));
        }else if(pis.getPISAliq()!=null){
            imp.setPis_cofins(pis.getPISAliq().getCST());
            imp.setAliq_pis(clsaux.trataCampoNulo(pis.getPISAliq().getPPIS()));
            imp.setBase_pis(clsaux.trataCampoNulo(pis.getPISAliq().getVBC()));
            imp.setValor_pis(clsaux.trataCampoNulo(pis.getPISAliq().getVPIS()));
            
            imp.setAliq_cofins(clsaux.trataCampoNulo(cofins.getCOFINSAliq().getPCOFINS()));
            imp.setValor_cofins(clsaux.trataCampoNulo(cofins.getCOFINSAliq().getVCOFINS()));
        }
        return imp;
    }
    public clsLancDocument validaImpostoIpiCompra(TIpi ipi, clsLancDocument imp ){
        if(ipi!=null){
            if (ipi.getIPITrib()!=null){
                imp.setCstipi(ipi.getIPITrib().getCST());
                imp.setBase_ipi(clsaux.trataCampoNulo(ipi.getIPITrib().getVBC()));
                imp.setAliq_ipi(clsaux.trataCampoNulo(ipi.getIPITrib().getPIPI()));
                imp.setValor_ipi(clsaux.trataCampoNulo(ipi.getIPITrib().getVIPI()));

            }else if (ipi.getIPINT()!=null){
                imp.setCstipi(ipi.getIPINT().getCST());
            }

       }
    
        return imp;
    }
    public clsLancDocument validaImpostoIcmsCompra(TNFe.InfNFe.Det.Imposto.ICMS icms, clsLancDocument imp ){
        
        if(icms.getICMS00()!=null){
            
            imp.setCst(icms.getICMS00().getCST());
            imp.setOrigem_produto(icms.getICMS00().getOrig());
            imp.setModbc(icms.getICMS00().getModBC());
            imp.setBase_icms(icms.getICMS00().getVBC());
            imp.setAliq_icms(icms.getICMS00().getPICMS());
            imp.setValor_icms(icms.getICMS00().getVICMS());
            
        }else if(icms.getICMS10()!=null){
            
            imp.setCst(icms.getICMS10().getCST());
            imp.setOrigem_produto(icms.getICMS10().getOrig());
            imp.setModbc(icms.getICMS10().getModBC());
            imp.setBase_icms(icms.getICMS10().getVBC());
            imp.setAliq_icms(icms.getICMS10().getPICMS());
            imp.setValor_icms(icms.getICMS10().getVICMS());
            imp.setValor_st(icms.getICMS10().getVICMSST());
            imp.setBase_st(icms.getICMS10().getVBCST());
        }else if(icms.getICMS20()!=null){
            
            imp.setCst(icms.getICMS20().getCST());
            imp.setOrigem_produto(icms.getICMS20().getOrig());
            imp.setModbc(icms.getICMS20().getModBC());
            imp.setBase_icms(icms.getICMS20().getVBC());
            imp.setAliq_icms(icms.getICMS20().getPICMS());
            imp.setValor_icms(icms.getICMS20().getVICMS());
            imp.setRed_bc(icms.getICMS20().getPRedBC());
        }
        else if(icms.getICMS30()!=null){
            imp.setCst(icms.getICMS30().getCST());
            imp.setOrigem_produto(icms.getICMS30().getOrig());
            imp.setBase_st(icms.getICMS30().getVBCST());
            imp.setValor_st(icms.getICMS30().getVICMSST());
        }
        else if(icms.getICMS40()!=null){
            
            imp.setCst(icms.getICMS40().getCST());
            imp.setOrigem_produto(icms.getICMS40().getOrig());
            
        }
        else if(icms.getICMS51()!=null){
            
            imp.setCst(icms.getICMS51().getCST());
            imp.setOrigem_produto(icms.getICMS51().getOrig());
            imp.setModbc(icms.getICMS51().getModBC());
            imp.setBase_icms(icms.getICMS51().getVBC());
            imp.setAliq_icms(icms.getICMS51().getPICMS());
            imp.setValor_icms(icms.getICMS51().getVICMS());
            imp.setRed_bc(icms.getICMS51().getPRedBC());
            
        }else if(icms.getICMS60()!=null){
           imp.setCst(icms.getICMS60().getCST());
            imp.setOrigem_produto(icms.getICMS60().getOrig());
            imp.setBase_stretido(icms.getICMS60().getVBCSTRet());
            imp.setValor_stretido(icms.getICMS60().getVICMSSTRet());
            
        }else if(icms.getICMS70()!=null){
           
        }
        else if(icms.getICMS90()!=null){
            imp.setCst(icms.getICMS90().getCST());
            imp.setOrigem_produto(icms.getICMS90().getOrig());
            imp.setModbc(icms.getICMS90().getModBC());
            imp.setBase_icms(icms.getICMS90().getVBC());
            imp.setAliq_icms(icms.getICMS90().getPICMS());
            imp.setValor_icms(icms.getICMS90().getVICMS());
            imp.setValor_st(icms.getICMS90().getVICMSST());
            imp.setBase_st(icms.getICMS90().getVBCST());
            
        }
        else if(icms.getICMSSN101()!=null){
           
            imp.setCst(icms.getICMSSN101().getCSOSN());
            imp.setOrigem_produto(icms.getICMSSN101().getOrig());
        }
        else if(icms.getICMSSN102()!=null){
            imp.setCst(icms.getICMSSN102().getCSOSN());
            imp.setOrigem_produto(icms.getICMSSN102().getOrig());
            
        }
        else if(icms.getICMSSN201()!=null){
            imp.setCst(icms.getICMSSN201().getCSOSN());
            imp.setOrigem_produto(icms.getICMSSN201().getOrig());
            imp.setBase_st(icms.getICMSSN201().getVBCST());
            imp.setValor_st(icms.getICMSSN201().getVICMSST());
        }else if(icms.getICMSSN202()!=null){
            imp.setCst(icms.getICMSSN202().getCSOSN());
            imp.setOrigem_produto(icms.getICMSSN202().getOrig());
            imp.setBase_st(icms.getICMSSN202().getVBCST());
            imp.setValor_st(icms.getICMSSN202().getVICMSST());
        }else if(icms.getICMSSN500()!=null){
            imp.setCst(icms.getICMSSN500().getCSOSN());
            imp.setOrigem_produto(icms.getICMSSN500().getOrig());
            imp.setBase_stretido(icms.getICMSSN500().getVBCSTRet());
            imp.setValor_stretido(icms.getICMSSN500().getVICMSSTRet());
        }else if(icms.getICMSSN900()!=null){
            imp.setCst(icms.getICMSSN900().getCSOSN());
            imp.setOrigem_produto(icms.getICMSSN900().getOrig());
            imp.setBase_icms(icms.getICMSSN900().getVBCST());
            imp.setValor_icms(icms.getICMSSN900().getVICMS());
            imp.setBase_st(icms.getICMSSN900().getVBCST());
            imp.setValor_st(icms.getICMSSN900().getVICMSST());
        }
         return imp;
    }
    public void carregaDadosFinanceiroXml(){
        TNFe.InfNFe.Cobr cobranca=inf.getCobr();
        TNFe.InfNFe.Pag pagamento= inf.getPag();
        DefaultTableModel tbl = (DefaultTableModel) tblParcelas.getModel();
        if(cobranca!=null){
            for (int i=0;i<cobranca.getDup().size();i++){
                    tbl.addRow(new Object[]{
                    clsaux.preencheData(),
                        "5",
                        "BOLETO",
                         cobranca.getDup().get(i).getNDup(),
                    cobranca.getDup().get(i).getVDup(),
                    clsaux.convertDataExib(cobranca.getDup().get(i).getDVenc())
            });
        }
        }else{
            for (int i=0;i<pagamento.getDetPag().size();i++){
                
                    tbl.addRow(new Object[]{
                    clsaux.preencheData(),
                        "1",
                        "Dinheiro",
                         pagamento.getDetPag().get(i).getIndPag(),
                         pagamento.getDetPag().get(i).getVPag(),
                         "00/00/0000"
            });
        }
    }
    }
    public static void populaTabelaItens(){
       DefaultTableModel tb= (DefaultTableModel) LancamentoDocumentos.tbItens.getModel();
       tb.setNumRows(0);
       for (int i=0;i<itens.size(); i++){
            tb.addRow(new Object[]{
                itens.get(i).getIdproduto(),
                itens.get(i).getCodfornecedor(),
                itens.get(i).getNumeroitem(),
                itens.get(i).getEanComer(),
                itens.get(i).getBarras(),
                itens.get(i).getDescricaofornecedor(),
                itens.get(i).getQntComercial(),
                itens.get(i).getQuantidade(),
                itens.get(i).getUnidade(),
                itens.get(i).getPrecovenda(),
                itens.get(i).getDesconto(),
                itens.get(i).getAcrescimo(),
                itens.get(i).getSubtotal(),
                itens.get(i).getTotal(),
                itens.get(i).getValor_st(),
                itens.get(i).getValor_icms(),
                itens.get(i).getValor_ipi(),
                itens.get(i).getValor_pis(),
                itens.get(i).getValor_cofins(),
                itens.get(i).getCst()
            });
        }
       numeitem= Integer.parseInt(itens.get(itens.size()-1).getNumeroitem())+1;
       informaItensSemCadastro();
   }
    
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(LancamentoDocumentos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(LancamentoDocumentos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(LancamentoDocumentos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(LancamentoDocumentos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                LancamentoDocumentos dialog = new LancamentoDocumentos(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox CbFinalizadora;
    private javax.swing.JComboBox<String> CbParcelas;
    private javax.swing.JButton btnAlterar;
    private javax.swing.JButton btnExcluir;
    private javax.swing.JButton btnExluirPag;
    private javax.swing.JButton btnGravar;
    private javax.swing.JButton btnIncluir;
    private javax.swing.JButton btnOk;
    private javax.swing.JButton btnPesq;
    private javax.swing.JComboBox<String> cbTipodoc;
    private javax.swing.JFormattedTextField ftDatemissao;
    private javax.swing.JFormattedTextField ftDatlancamento;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel22;
    private javax.swing.JLabel jLabel23;
    private javax.swing.JLabel jLabel24;
    private javax.swing.JLabel jLabel25;
    private javax.swing.JLabel jLabel26;
    private javax.swing.JLabel jLabel27;
    private javax.swing.JLabel jLabel28;
    private javax.swing.JLabel jLabel29;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTabbedPane jTabbedPane1;
    public static javax.swing.JTable tbItens;
    private javax.swing.JTable tblParcelas;
    private javax.swing.JTextField txtBaseicms;
    private javax.swing.JTextField txtBasest;
    private javax.swing.JTextField txtChave;
    private javax.swing.JTextField txtCnpj;
    private static javax.swing.JTextField txtDescont;
    private javax.swing.JTextField txtDocumento;
    private javax.swing.JTextField txtFone;
    public static javax.swing.JTextField txtIdParceiro;
    private javax.swing.JTextField txtInscricao;
    private javax.swing.JTextField txtMovto;
    private static javax.swing.JTextField txtOutdesp;
    private javax.swing.JTextField txtRazaoSocial;
    private javax.swing.JTextField txtSerie;
    private static javax.swing.JTextField txtTotalgeral;
    private static javax.swing.JTextField txtTotalprod;
    private javax.swing.JLabel txtTroco;
    private javax.swing.JTextField txtValoricms;
    private javax.swing.JTextField txtValorrecebido;
    private javax.swing.JTextField txtValorst;
    public static javax.swing.JLabel txtValortotaldocumento;
    private static javax.swing.JTextField txtVlIpi;
    // End of variables declaration//GEN-END:variables

    
}
